<config-template xmlns="http://tail-f.com/ns/config/1.0">
  <devices xmlns="http://tail-f.com/ns/ncs">
    <!-- ...Cisco leaf... -->
    <device>
          <name>{$leafname}</name>
    <config>
      <feature xmlns="http://tail-f.com/ned/cisco-nx">
        <bgp/>
        <lldp/>
      </feature>
      <ip xmlns="http://tail-f.com/ned/cisco-nx">
        <prefix-list>
          <prefixes>
            <name>def-route-pl</name>
            <description>default route</description>
            <seq>
              <no>5</no>
              <permit>0.0.0.0/0</permit>
            </seq>
          </prefixes>
          <prefixes>
            <name>local2bgp-pl</name>
            <seq>
              <no>{$seq_no}</no>
              <permit>{$leaf_subnet}</permit>
            </seq>
          </prefixes>
        </prefix-list>
      </ip>
      <route-map xmlns="http://tail-f.com/ned/cisco-nx">
        <name>leaf2spine</name>
        <sequence>5</sequence>
        <operation>deny</operation>
        <match>
          <ip>
            <address>
              <access-list>def-route-pl</access-list>
            </address>
          </ip>
        </match>
      </route-map>
      <route-map xmlns="http://tail-f.com/ned/cisco-nx">
        <name>leaf2spine</name>
        <sequence>10</sequence>
        <operation>permit</operation>
        <match>
          <ip>
            <address>
              <prefix-list>local2bgp-pl</prefix-list>
            </address>
          </ip>
        </match>
      </route-map>
      <route-map xmlns="http://tail-f.com/ned/cisco-nx">
        <name>local2bgp</name>
        <sequence>10</sequence>
        <operation>permit</operation>
        <match>
          <ip>
            <address>
              <prefix-list>local2bgp-pl</prefix-list>
            </address>
          </ip>
        </match>
      </route-map>
      <interface xmlns="http://tail-f.com/ned/cisco-nx">
        <Ethernet>
          <name>{$leaf_interf}</name>
          <enable>
            <switchport>false</switchport>
          </enable>
          <ip>
            <address>
              <ipaddr>{$leaf_ip}/{$prefix}</ipaddr>
            </address>
          </ip>
		  <shutdown tags="delete"/>
        </Ethernet>
      </interface>
      <router xmlns="http://tail-f.com/ned/cisco-nx">
        <bgp>
          <id>{$leaf_as}</id>
          <template>
            <peer>
              <name>LEAF2SPINE</name>
              <address-family>
                <proto>ipv4</proto>
                <type>unicast</type>
                <route-map>
                  <direction>out</direction>
                  <name>leaf2spine</name>
                </route-map>
              </address-family>
              <remote-as>{$spine_as}</remote-as>
            </peer>
          </template>
          <address-family>
            <proto>ipv4</proto>
            <type>unicast</type>
            <maximum-paths>
              <ibgp>4</ibgp>
              <number>16</number>
            </maximum-paths>
            <redistribute>
              <direct>
                <route-map>local2bgp</route-map>
              </direct>
            </redistribute>
          </address-family>
          <router-id>{$leaf_loopback0}</router-id>
          <neighbor>
            <id>{$peer_vlan6}</id>
            <inner-remote-as>
              <remote-as>{$leaf_as}</remote-as>
            </inner-remote-as>
            <description>***iBGP to {$peername}_VLAN6***</description>
            <address-family>
              <proto>ipv4</proto>
              <type>unicast</type>
              <send-community>
              </send-community>
              <soft-reconfiguration>
                <inbound/>
              </soft-reconfiguration>
            </address-family>
          </neighbor>
          <neighbor>
            <id>{$spine_ip}</id>
            <description>***eBGP to {$spinename}_{$spine_interf}***</description>
            <inherit>
              <peer>LEAF2SPINE</peer>
            </inherit>
          </neighbor>
          <neighbor-down>
            <fib-accelerate/>
          </neighbor-down>
        </bgp>
      </router>
    </config>
    </device>
	<!-- ...Arista Leaf... -->
	<device>
	    <name>{$leafname}</name>
    <config>
      <ip xmlns="http://tail-f.com/ned/arista-dcs">
        <prefix-list>
          <prefixes>
            <name>def-route-pl</name>
            <seq>
              <no>5</no>
              <permit>
                <ip>0.0.0.0/0</ip>
              </permit>
            </seq>
          </prefixes>
          <prefixes>
            <name>local2bgp-pl</name>
            <seq>
              <no>{$seq_no}</no>
              <permit>
                <ip>{$leaf_subnet}</ip>
              </permit>
            </seq>
          </prefixes>
        </prefix-list>
      </ip>
      <route-map xmlns="http://tail-f.com/ned/arista-dcs">
        <name>leaf2spine</name>
        <sequence>5</sequence>
        <operation>deny</operation>
        <match>
          <ip>
            <address>
              <prefix-list>def-route-pl</prefix-list>
            </address>
          </ip>
        </match>
      </route-map>
      <route-map xmlns="http://tail-f.com/ned/arista-dcs">
        <name>leaf2spine</name>
        <sequence>10</sequence>
        <operation>permit</operation>
        <match>
          <ip>
            <address>
              <prefix-list>local2bgp-pl</prefix-list>
            </address>
          </ip>
        </match>
      </route-map>
      <route-map xmlns="http://tail-f.com/ned/arista-dcs">
        <name>local2bgp</name>
        <sequence>10</sequence>
        <operation>permit</operation>
        <match>
          <ip>
            <address>
              <prefix-list>local2bgp-pl</prefix-list>
            </address>
          </ip>
        </match>
      </route-map>
      <router xmlns="http://tail-f.com/ned/arista-dcs">
        <bgp>
          <id>{$leaf_as}</id>
          <router-id>{$leaf_loopback0}</router-id>
          <non-vrf>
            <neighbor>
              <id>{$spine_ip}</id>
              <description>***eBGP to {$spinename}{$spine_interf}***</description>
              <maximum-routes>
                <number>0</number>
                <warning-only/>
              </maximum-routes>
              <remote-as>{$spine_as}</remote-as>
              <route-map>
                <inout>out</inout>
                <route-map-name>leaf2spine</route-map-name>
              </route-map>
              <send-community>
              </send-community>
            </neighbor>
            <neighbor>
              <id>{$peer_vlan6}</id>
              <description>***iBGP to {$peername}_VLAN6***</description>
              <maximum-routes>
                <number>0</number>
                <warning-only/>
              </maximum-routes>
              <remote-as>{$leaf_as}</remote-as>
              <send-community>
              </send-community>
            </neighbor>
            <redistribute>
              <connected>
                <route-map>local2bgp</route-map>
              </connected>
            </redistribute>
          </non-vrf>
        </bgp>
      </router>
      <interface xmlns="http://tail-f.com/ned/arista-dcs">
        <Ethernet>
          <name>{$leaf_interf}</name>
          <no-switchport>
            <switchport>false</switchport>
          </no-switchport>
          <ip>
            <address>
              <address-primary>{$leaf_ip}/{$prefix}</address-primary>
            </address>
          </ip>
		  <shutdown tags="delete"/>
        </Ethernet>
      </interface>
    </config>
	</device>
	  <!-- ...SPINE CONFIG... -->
    <device>
       <name>{$spinename}</name>
    <config>
      <interface xmlns="http://tail-f.com/ned/cisco-nx">
      <Ethernet>
        <name>{$spine_interf}</name>
		<shutdown tags="delete"/>
        <enable>
          <switchport>false</switchport>
        </enable>
        <ip>
          <address>
            <ipaddr>{$spine_ip}/{$prefix}</ipaddr>
          </address>
        </ip>
      </Ethernet>
      </interface>
      <router xmlns="http://tail-f.com/ned/cisco-nx">
      <bgp>
        <id>{$spine_as}</id>
        <address-family>
          <proto>ipv4</proto>
          <type>unicast</type>
        </address-family>
        <neighbor>
          <id>{$leaf_ip}</id>
          <inner-remote-as>
            <remote-as>{$leaf_as}</remote-as>
          </inner-remote-as>
          <address-family>
            <proto>ipv4</proto>
            <type>unicast</type>
          </address-family>
        </neighbor>
      </bgp>
      </router>
      </config>
  </device>
  </devices>
</config-template>
